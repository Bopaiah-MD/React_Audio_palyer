{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport axios from 'axios';\n\nfunction useAuth(code) {\n  _s();\n\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  useEffect(() => {\n    axios.post(\"http://localhost:3001/login\", {\n      code\n    }).then(res => {\n      //console.log(\"Auth Token\",res.data);\n      setAccessToken(res.data.accessToken);\n      setRefreshToken(res.data.refreshToken);\n      setExpiresIn(res.data.expiresIn);\n      window.history.pushState({}, null, \"/\"); // clear from url\n    }).catch(() => {\n      window.location = \"/\";\n    });\n  }, [code]); //invoke when refreshToken or expiresIn changes  & add a route in server.js\n  //i.e /refresh post\n\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return; //always invoke refresh after /login above effect call soadd delay \n\n    const timeout = setInterval(() => {\n      axios.post(\"http://localhost:3001/refresh\", {\n        refreshToken\n      }).then(res => {\n        console.log(\"refreshToken Token\", res.data);\n        setAccessToken(res.data.accessToken);\n        setExpiresIn(res.data.expiresIn); // window.history.pushState({}, null, \"/\") // clear from url\n      }).catch(() => {\n        window.location = \"/\";\n      });\n    }, (expiresIn - 60) * 1000);\n    return () => clearInterval(timeout); // unmount clear timeout \n  }, [refreshToken, expiresIn]);\n  return accessToken;\n}\n\n_s(useAuth, \"BjfIEYIBT3fGKX8NIIc/0+kqeyA=\");\n\nexport default useAuth;","map":{"version":3,"sources":["/Users/bomd/Documents/Learnings /react-spotify/client/src/useAuth.js"],"names":["useState","useEffect","axios","useAuth","code","accessToken","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","post","then","res","data","window","history","pushState","catch","location","timeout","setInterval","console","log","clearInterval"],"mappings":";;AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAQC,KAAR,MAAmB,OAAnB;;AAEA,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AAAA;;AAEnB,QAAM,CAACC,WAAD,EAAeC,cAAf,IAAiCN,QAAQ,EAA/C;AACA,QAAM,CAACO,YAAD,EAAgBC,eAAhB,IAAmCR,QAAQ,EAAjD;AACA,QAAM,CAACS,SAAD,EAAaC,YAAb,IAA6BV,QAAQ,EAA3C;AAEEC,EAAAA,SAAS,CAAC,MAAM;AACdC,IAAAA,KAAK,CACFS,IADH,CACQ,6BADR,EACuC;AACnCP,MAAAA;AADmC,KADvC,EAIGQ,IAJH,CAIQC,GAAG,IAAI;AACX;AAEAP,MAAAA,cAAc,CAACO,GAAG,CAACC,IAAJ,CAAST,WAAV,CAAd;AACAG,MAAAA,eAAe,CAACK,GAAG,CAACC,IAAJ,CAASP,YAAV,CAAf;AACAG,MAAAA,YAAY,CAACG,GAAG,CAACC,IAAJ,CAASL,SAAV,CAAZ;AACAM,MAAAA,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,IAA7B,EAAmC,GAAnC,EANW,CAM6B;AACzC,KAXH,EAWKC,KAXL,CAWW,MAAM;AACbH,MAAAA,MAAM,CAACI,QAAP,GAAkB,GAAlB;AACD,KAbH;AAcD,GAfQ,EAeN,CAACf,IAAD,CAfM,CAAT,CANiB,CAyBjB;AACA;;AACAH,EAAAA,SAAS,CAAC,MAAM;AACd,QAAG,CAACM,YAAD,IAAiB,CAACE,SAArB,EAAiC,OADnB,CAEd;;AAEA,UAAMW,OAAO,GAAGC,WAAW,CAAC,MAAK;AAC/BnB,MAAAA,KAAK,CACJS,IADD,CACM,+BADN,EACuC;AACrCJ,QAAAA;AADqC,OADvC,EAICK,IAJD,CAIMC,GAAG,IAAI;AACXS,QAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAiCV,GAAG,CAACC,IAArC;AAEAR,QAAAA,cAAc,CAACO,GAAG,CAACC,IAAJ,CAAST,WAAV,CAAd;AACAK,QAAAA,YAAY,CAACG,GAAG,CAACC,IAAJ,CAASL,SAAV,CAAZ,CAJW,CAKX;AACD,OAVD,EAUGS,KAVH,CAUS,MAAM;AACbH,QAAAA,MAAM,CAACI,QAAP,GAAkB,GAAlB;AACD,OAZD;AAaD,KAd0B,EAcxB,CAACV,SAAS,GAAG,EAAb,IAAmB,IAdK,CAA3B;AAgBA,WAAO,MAAMe,aAAa,CAACJ,OAAD,CAA1B,CApBc,CAoBsB;AAGrC,GAvBQ,EAuBN,CAACb,YAAD,EAAeE,SAAf,CAvBM,CAAT;AAyBA,SAAOJ,WAAP;AAGL;;GAvDQF,O;;AAyDT,eAAeA,OAAf","sourcesContent":["import { useState, useEffect } from 'react'\nimport  axios from 'axios';\n\nfunction useAuth(code) {\n\n    const [accessToken , setAccessToken] = useState();\n    const [refreshToken , setRefreshToken] = useState();\n    const [expiresIn , setExpiresIn] = useState();\n\n      useEffect(() => {\n        axios\n          .post(\"http://localhost:3001/login\", {\n            code,\n          })\n          .then(res => {\n            //console.log(\"Auth Token\",res.data);\n            \n            setAccessToken(res.data.accessToken)\n            setRefreshToken(res.data.refreshToken)\n            setExpiresIn(res.data.expiresIn)\n            window.history.pushState({}, null, \"/\") // clear from url\n          }).catch(() => {\n            window.location = \"/\"\n          })\n      }, [code])\n\n      \n\n      //invoke when refreshToken or expiresIn changes  & add a route in server.js\n      //i.e /refresh post\n      useEffect(() => {\n        if(!refreshToken || !expiresIn ) return;\n        //always invoke refresh after /login above effect call soadd delay \n\n        const timeout = setInterval(()=> {\n          axios\n          .post(\"http://localhost:3001/refresh\", {\n            refreshToken,\n          })\n          .then(res => {\n            console.log(\"refreshToken Token\",res.data);\n            \n            setAccessToken(res.data.accessToken) \n            setExpiresIn(res.data.expiresIn)\n            // window.history.pushState({}, null, \"/\") // clear from url\n          }).catch(() => {\n            window.location = \"/\"\n          })\n        }, (expiresIn - 60) * 1000)\n\n        return () => clearInterval(timeout) // unmount clear timeout \n\n        \n      }, [refreshToken, expiresIn])\n\n      return accessToken;\n\n    \n}\n\nexport default useAuth\n"]},"metadata":{},"sourceType":"module"}